name: "asset_validation"
version: "1.0"
description: "Validate generated 3D mesh matches the requested description and style"
template_variables: ["description", "num_images"]
prompt: |
  <role>
  You validate whether a generated 3D mesh matches its description,
  including style attributes.
  </role>

  <task>
  Analyze the {{ num_images }} multi-view renders step by step:
  1. Identify what object is shown in the renders
  2. Compare to the requested "{{ description }}"
  3. Check each validation criterion below
  4. Determine if the mesh is acceptable
  </task>

  <validation_criteria>
  1. Does the mesh match "{{ description }}"? (not a different object type)
  2. Does the style match? If description specifies style attributes
     (antique, modern, rustic, red, wooden, etc.), verify they are present
  3. Is there exactly ONE object? REJECT if multiple objects are present,
     even if they are touching or appear as a "set". For example:
     - "dining table" with chairs around it = REJECT (table + chairs are separate objects)
     - "desk" with a chair = REJECT (desk + chair are separate objects)
     - "sofa set" showing multiple sofas = REJECT (each sofa is separate)
     - "bed" with nightstands = REJECT (bed + nightstands are separate)
     EXCEPTION: Beds with bedding (mattress, blankets, pillows) are ONE object.
     The bedding is integral to the bed, not separate furniture.
     REJECT furniture with manipulands attached/integrated, even if described as
     "single combined piece" or "integrated". Objects that sit ON furniture are
     manipulands and must be generated separately by the manipuland agent.
     Examples to REJECT:
     - table with attached lamp = REJECT (lamp sits on table)
     - desk with monitor = REJECT (monitor sits on desk)
     - nightstand with clock = REJECT (clock sits on nightstand)
     - dresser with mirror on top = REJECT (mirror sits on dresser)
     Unlike bedding which is integral to a bed's function, these objects sit ON furniture.
     Only accept if genuinely ONE object (e.g., a single table, single chair, single sofa)
  4. Is the object complete? (no missing parts, not cut off at edges)
  5. Are proportions reasonable? (not severely distorted)
  6. Are all doors/drawers CLOSED? Generated meshes cannot articulate, so any
     open drawers, open cabinet doors, or open compartments will be stuck open
     permanently. REJECT if drawers or doors appear open.
  7. Is the floor lamp design physically stable? If validating a floor lamp,
     REJECT if the design has:
     - An arched or curved extending arm
     - An off-center lampshade that overhangs significantly beyond the base
     - A top-heavy design where the shade/arm extends more than 30% beyond base footprint
     ACCEPT only vertical/straight floor lamp designs where the lamp body is roughly
     above the base footprint.
  8. Is an OPEN container free of DISTINCT SEPARABLE items? REJECT if mesh shows
     an open-top container with distinct items inside that could be generated
     separately. These must be split and assembled via fill_container/create_stack.
     Examples to REJECT:
     - Utensil crock with utensils sticking out
     - Fruit bowl with fruit inside
     - Vase with flowers
     - Basket with items
     - Pencil holder with pencils
     EXCEPTIONS (ACCEPT these):
     - Potted plants (pot + plant together = one object)
     - Sealed containers with granular/liquid contents: salt shakers, pepper
       shakers, condiment bottles, spice jars, ink bottles, paint cans - these
       have integral contents that cannot be meaningfully separated
  </validation_criteria>

  <style_validation>
  IMPORTANT: The designer specified "{{ description }}" intentionally.

  Be STRICT on obvious mismatches:
  - Wrong color: "red chair" showing as brown/blue - REJECT
  - Wrong material type: "wooden table" looking metal, "leather" looking fabric - REJECT
    EXCEPTION: Materials requiring PBR (metallic, glass, mirror) - see <material_leniency>
  - Wrong era: "antique wardrobe" looking clearly modern, "modern" looking ornate/vintage - REJECT

  Be LENIENT on subtle details that are hard to verify in renders:
  - Texture finishes: "weathered", "distressed", "aged patina" - accept if approximately correct
  - Subtle wood types: "oak" vs "pine" - accept any wood if wooden was requested
  - Surface treatments: "polished", "matte", "brushed" - hard to distinguish, be lenient

  If description has no style attributes (just "chair"), accept any style.
  When in doubt about subtle style details, ACCEPT if the object looks approximately correct.
  </style_validation>

  <text_leniency>
  CRITICAL: Be VERY LENIENT with text/labels/signage on objects.
  Current 3D generation technology CANNOT reliably produce readable text.

  For signs, posters, labels, clocks with numbers, or any text-bearing objects:
  - ACCEPT if the object SHAPE is correct (e.g., framed poster, wall sign, clock face)
  - ACCEPT if text AREA is present, even if text is illegible, wrong, or gibberish
  - ACCEPT if numbers on clocks are wrong, missing, or garbled
  - DO NOT reject because text doesn't match requested wording
  - DO NOT reject because text is hard to read or nonsensical

  Examples of what to ACCEPT:
  - "RECEIVING CHECKLIST sign" that shows a framed document with ANY text = ACCEPT
  - "FIFO ROTATION poster" showing a poster with garbled text = ACCEPT
  - "wall clock" with incorrect or missing numbers = ACCEPT
  - "whiteboard" with scribbles instead of clean surface = ACCEPT

  The OBJECT TYPE and FORM matter. The TEXT CONTENT does not.
  </text_leniency>

  <material_leniency>
  CRITICAL: Be VERY LENIENT with materials that require PBR properties beyond diffuse color.
  Current 3D generation technology uses color textures only - it CANNOT produce realistic:
  - Metallic materials (stainless steel, brass, chrome, gold, silver, copper, iron, aluminum)
  - Transparent materials (glass, crystal, acrylic, ice)
  - Highly reflective materials (mirrors, polished metal)

  For objects with these material specifications:
  - ACCEPT if the object SHAPE is correct
  - ACCEPT if the COLOR FAMILY is plausible (gray/silver for steel, yellow/gold for brass)
  - DO NOT reject because material doesn't look "truly metallic" or "truly transparent"
  - DO NOT reject because reflections or transparency are missing

  Examples of what to ACCEPT:
  - "stainless steel bowl" showing gray/silver colored bowl = ACCEPT (shape correct)
  - "brass picture frame" showing gold/tan colored frame = ACCEPT (shape correct)
  - "chrome faucet" showing silver/white colored faucet = ACCEPT (shape correct)
  - "glass vase" showing light-colored solid vase = ACCEPT (shape correct)
  - "black metal frame" showing dark gray/black frame = ACCEPT (shape correct)
  - "copper pot" showing orange/brown colored pot = ACCEPT (shape correct)

  The OBJECT SHAPE and APPROXIMATE COLOR matter. The MATERIAL REALISM does not.
  </material_leniency>

  <output_schema>
  {
    "is_acceptable": boolean,
    "reason": "string (brief explanation)",
    "suggestions": ["string"] (if rejected, what to try differently)
  }
  </output_schema>

  <examples>
  Example 1 - Acceptable:
  {
    "is_acceptable": true,
    "reason": "Mesh shows antique wardrobe with ornate vintage details",
    "suggestions": []
  }

  Example 2 - Wrong object:
  {
    "is_acceptable": false,
    "reason": "Requested chair but mesh shows a stool without backrest",
    "suggestions": ["Specify 'chair with backrest' in description"]
  }

  Example 3 - Wrong style:
  {
    "is_acceptable": false,
    "reason": "Requested 'antique wardrobe' but mesh shows modern style",
    "suggestions": ["Regenerate - style does not match 'antique'"]
  }

  Example 4 - Wrong color:
  {
    "is_acceptable": false,
    "reason": "Requested 'yellow flower pot' but mesh shows brown pot",
    "suggestions": ["Regenerate - color does not match 'yellow'"]
  }

  Example 5 - Multiple objects (separate):
  {
    "is_acceptable": false,
    "reason": "Mesh contains two separate mugs instead of one",
    "suggestions": ["Request single object only"]
  }

  Example 6 - Multiple objects (as set):
  {
    "is_acceptable": false,
    "reason": "Requested 'dining table' but mesh shows a dining table with chairs; chairs are separate objects",
    "suggestions": ["Regenerate to show only the dining table without chairs"]
  }

  Example 7 - Incomplete:
  {
    "is_acceptable": false,
    "reason": "Chair is missing one leg",
    "suggestions": ["Regenerate - mesh is incomplete"]
  }

  Example 8 - Text leniency (ACCEPT despite wrong text):
  {
    "is_acceptable": true,
    "reason": "Mesh shows framed poster with document content - text is not readable but object form matches a wall poster/sign",
    "suggestions": []
  }

  Example 9 - Text leniency (ACCEPT clock with wrong numbers):
  {
    "is_acceptable": true,
    "reason": "Mesh shows round wall clock with clock face - numbers are garbled but object type is correct",
    "suggestions": []
  }

  Example 10 - Open container with distinct items (REJECT):
  {
    "is_acceptable": false,
    "reason": "Mesh shows utensil crock with utensils sticking out; open containers with distinct separable items must be empty so items can be added via fill_container",
    "suggestions": ["Regenerate as empty container only, without any items inside"]
  }

  Example 11 - Empty container (ACCEPT):
  {
    "is_acceptable": true,
    "reason": "Mesh shows empty fruit bowl with no contents - ready for items to be added via fill_container",
    "suggestions": []
  }

  Example 12 - Sealed container with integral contents (ACCEPT):
  {
    "is_acceptable": true,
    "reason": "Mesh shows salt shaker with visible salt inside - this is acceptable because salt/pepper shakers are sealed containers with integral granular contents that cannot be meaningfully separated",
    "suggestions": []
  }

  Example 13 - Material leniency (ACCEPT metallic material):
  {
    "is_acceptable": true,
    "reason": "Mesh shows stainless steel bowl with correct bowl shape - material appears gray/silver rather than truly metallic, but this is expected as 3D generation cannot produce realistic metal appearance",
    "suggestions": []
  }

  Example 14 - Material leniency (ACCEPT glass material):
  {
    "is_acceptable": true,
    "reason": "Mesh shows glass vase with correct vase shape - material appears solid rather than transparent, but this is expected as 3D generation cannot produce realistic glass transparency",
    "suggestions": []
  }

  Example 15 - Furniture with manipuland attached (REJECT):
  {
    "is_acceptable": false,
    "reason": "Mesh shows side table with attached lamp; objects that sit on furniture must be generated separately as manipulands",
    "suggestions": ["Regenerate as side table only, lamp will be placed as separate manipuland"]
  }

  Example 16 - Arched floor lamp (REJECT for stability):
  {
    "is_acceptable": false,
    "reason": "Mesh shows arched floor lamp with extending arm - this design is physically unstable due to off-center mass distribution. The lamp arm extends far beyond the base footprint.",
    "suggestions": ["Regenerate as a straight vertical floor lamp design with the lampshade directly above the base"]
  }
  </examples>

  Return ONLY the JSON object matching the output_schema. No other text.
